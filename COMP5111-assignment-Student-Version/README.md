# COMP5111 (Spring 2021) Assignment 1

## Deadline: March 7, 2021 - 23:55

## Assignment Objective

In assignment 1, you are expected to: 
1. Generate test cases using Randoop; 
2. Use EclEmma to measure test coverage; 
3. Build a test coverage tool with Soot.

We have prepared tutorials to help you accomplish this assignment.

### Have Questions?
1. If you have questions, please first check our [FAQ](Assignment1_FAQ.md). 
2. If your problem is not solved, you are recommended to create `Issues` in this repository.
   Issues shall be replied by the TA within 24 hrs.
3. If you want to discuss with other classmates, you can go to `Discussions` of this repository. 
   Note that this repository is `ONLY` for programming assignment. 
   Your reading reports and related discussions should be put on CANVAS.
3. If you don't want your question to be visible to other classmates, you can send an email to the TA. 

## Assignment Materials

### Class Under Test

Please download/fork the project in this repo, which we have prepared for this assignment [here](docs/assignment1).
The project contains a Java Class under test (CUT), `comp5111.assignment.cut.ToolBox`, residing in `src/main/java/`.
You need to generate test suites for this program and measure the corresponding test coverage, i.e., the percentages 
of statements/branches/lines of this program covered by the generated tests.

**Note that all inner classes of CUT should be included in the test.**

The CUT program that we prepared indeed contains bugs. 
You do not need to locate the bugs in assignment 1. 
We will work on them in assignment 2.

### Platform

Assignment 1 requires the use of both Eclipse and command line with Java 8 (SDK).

The following environment and library versions are recommended.

#### Environment
- Linux/Mac/Windows
- Java SDK 8
- Eclipse, 2020.12 version
  
#### Libraries
- [Randoop 4.2.5](https://github.com/randoop/randoop/releases/download/v4.2.5/randoop-4.2.5.zip)
- [Soot 4.2.1](https://repo1.maven.org/maven2/org/soot-oss/soot/4.2.1/soot-4.2.1-jar-with-dependencies.jar)
- [JUnit 4.12](https://repo1.maven.org/maven2/junit/junit/4.12/junit-4.12.jar), with [hamcrest-1.3](https://repo1.maven.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar) (only needed if you get errors)

If you use `maven`, these dependencies have already been declared in `pom.xml`.
In case you want to use `jar` file of the libraries directly, we have already included them in `lib/`.

## Assignment Tasks

### Task 1: Test case generation and Code coverage measurement (30%)

You are expected to finish 2 sub tasks.

### Task 1.1: To learn how to use Randoop for unit test generation.

Randoop is a tool to generate JUnit test suites automatically.
A short tutorial about Randoop is avaiable [here](randoop.md), including how to use Randoop to generate unit tests, and execute them using Eclipse.

#### Requirements: 
1. You need to use Randoop to generate **5 different test suites** for the given program.
2. Each test suite must achieve at least 50% statement coverage.
3. 5 test suites should be different from each other. 
   Randoop parameter `--randomseed` may be helpful.
4. Package name of generated test suites should be `comp111.assignment.cut`.
   Randoop parameter `--junit-package-name` may be helpful.
5. 5 test suites should be put in `src/test/randoop<i>` for the `<i>`th test suite, where `0<=i<=4`. 
   Randoop parameter `--junit-output-dir` may be helpful.

#### Submissions: 
The 5 test suites generated by you, i.e., the folder `randoop0`, `randoop1`, `randoop2`, `randoop3`, and `randoop4` 
in `src/test`.

#### Grading Scheme:
Each test suite accounts for `3%` if it can be successfully executed.

### Task 1.2: To learn how to use EclEmma for code coverage measurement.

EclEmma is an Eclipse plugin to measure the code coverage. 
A tutorial is available [here](eclemma.md).

#### Requirements:
1. Please use EclEmma to measure the coverage of the 5 submitted test suites that you generated.

#### Submissions:
For **each test suite**, please submit a screenshot showing the instruction coverage, and a screenshot for branch coverage. 
In total, you are expected to submit a folder containing 10 screenshots.
Each screenshot should be properly named so that it identifies the corresponding instruction coverage or branch coverage.

#### Grading Scheme: 
Each screenshot accounts for `1.5%` if the values in the screenshot are correct.

### Task 2: Statement coverage measurement using Soot (40%)

Soot is a framework for analyzing and transforming Java programs.
We have prepared a tutorial about Soot, [here](soot.md). Answers to some common questions are available, [here](Assignment1_FAQ.md).

#### Requirements:
1. Use Soot to instrument the given CUT to measure statement coverage of tests.
   By statements, we refer to `Jimple statement`, which is an intermediate representation of Java program in Soot.

#### Notes:
- You may need to leverage Soot to insert a piece of code before or after each statement in Java bytecode.
When the unit tests are running, the inserted code logs if the associated bytecode is executed.
As such, your tool should be able to report the statement coverage achieved by a test suite.
- To validate the correctness of your statement coverage report, you can crosscheck it with the report generated by 
  EclEmma. The coverage reported by your tool should be close to that reported by EclEmma.

#### Grading Scheme:
- `30%` if your program can successfully instrument the code and report the coverage.
- `10%` if the results by your code are correct.


### Task 3: Branch coverage measurement using Soot (30%)

#### Requirements:
1. Use Soot to instrument the given CUT to measure `branch coverage` of tests.

#### Notes:
- The implementation is similar to that of task 2.
  While we insert code for each line in task 2, we insert code for
  each branch in task 3.
- You may reuse your code in task 2.

#### Grading Scheme:
- `20%` if your program can successfully instrument the program and report the coverage.
- `10%` if the results reported by your code are correct. 

### Bonus Task: Line coverage measurement using Soot (15%)

You can earn the bonus if you are able to finish the bonus task.
#### Requirements:
1. Use Soot to instrument the given CUT to measure `line coverage` of tests.

#### Notes:
The implementation of this bonus task is similar to that of task 2 except that you need to obtain the line number of Jimple code. 
Please refer to [FAQ Q9](./Assignment1_FAQ.md#9-how-to-preserve-the-line-number-in-soot) on how to obtain the line number.

#### Grading Scheme:
- `10%` if your program can successfully instrument the code and report the line coverage. 
- `5%` if the results by your code are correct.

### Program output:
For each coverage criterion (Task2, Task3, and Bonus Task), your program needs to at least output the following:

1. The coverage of each statement (statement, yes or no).
2. The statement coverage for each class (percentage), including inner classes.

### Submissions:
1. You may put your source code under `comp5111.assignment` package in `src/main/java` folder.
2. You are recommended to use Java build tools to manage your project, e.g., maven, or gradle.
3. Put useful scripts or readme files in the project root, containing instructions of how to run your implementation of **each task**.
4. A file showing the differences of the percentage (coverage for all classes) report by your tool and EclEmma, for 
   **all coverage criteria** you implemented. 
   Minor differences are allowed.
5. You need to measure all the five submitted test suites.
6. Advice: You are highly encouraged to maintain your code in a `private` repository at Github. It provides a backup of your code in case your computer crashes and allows us to retrieve code from your Github repository in case of submission errors. Such incidents did happen in the past.

## Assignment 1 Submission

- Your are required to submit your assignment to [CANVAS](https://canvas.ust.hk/courses/36243/assignments/142330). 
- Please put all your code, screenshot, readme and etc. into a single folder and compress it to `comp5111asg01.zip`

The recommended folder structure is:

1. Put your code into `${PROJECT_ROOT}/src/main/java/`
2. If you do not use Java build tools, put the libraries jar files that your code depends on into `${PROJECT_ROOT}/lib/`
3. Put your running scripts under `${PROJECT_ROOT}/scripts`
4. Put your screenshot into `${PROJECT_ROOT}/screenshots`
5. Put the test suites generated by you in to `${PROJECT_ROOT}/src/test/randoop[0-4]`

